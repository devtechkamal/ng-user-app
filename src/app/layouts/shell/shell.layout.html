<!-- Top Navbar -->
<header
  class="flex items-center justify-between bg-white px-4 py-3 border-b border-gray-300 md:px-6"
>
  <div class="flex items-center gap-4">
    <button class="md:hidden text-gray-700 hover:text-black" (click)="toggleMobileSidebar()">
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    <h1 class="text-xl font-semibold text-gray-800">User Management</h1>
  </div>

  <!-- User dropdown -->
  <div class="relative">
    <button
      (click)="userMenuOpen.set(!userMenuOpen())"
      class="flex items-center cursor-pointer gap-2 text-gray-700 hover:text-black"
    >
      <span>John Doe</span>
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M6 9l6 6 6-6" />
      </svg>
    </button>

    @if (userMenuOpen()) {
      <div
        class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-50"
      >
        <a class="block px-4 py-2 text-sm hover:bg-gray-100" [routerLink]="appUrl.Profile"
          >My Profile</a
        >
        <a class="block px-4 py-2 text-sm hover:bg-gray-100" href="#">Notifications</a>
        <a class="block px-4 py-2 text-sm hover:bg-gray-100" href="#">Logout</a>
      </div>
    }
  </div>
</header>

<!-- Sidebar + Main -->
<div class="flex h-[calc(100vh-52px)] overflow-hidden">
  <!-- Sidebar (Desktop) -->
  <aside class="hidden md:flex md:w-64 bg-white border-r border-gray-300 flex-col p-4">
    <div class="flex-1 overflow-hidden">
      <nav
        class="h-full overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 space-y-6"
      >
        @for (section of sidebar; track section.title) {
          <div>
            <p class="text-xs font-semibold text-gray-500 uppercase mb-2">
              {{ section.title }}
            </p>
            @for (item of section.items; track item.label) {
              @if (!item.children) {
                <a
                  [routerLink]="item.route"
                  class="block px-3 py-2 mb-1 rounded text-sm text-gray-700 hover:text-white bg-gray-100 hover:bg-primary-500"
                >
                  {{ item.label }}
                </a>
              } @else {
                <div>
                  <button
                    (click)="toggleSection(item.label)"
                    class="w-full flex justify-between items-center px-2 py-1.5 rounded hover:bg-gray-200 text-sm text-blue-700"
                  >
                    {{ item.label }}
                    <svg
                      [class]="{ 'rotate-90': openSection() === item.label }"
                      class="w-4 h-4 transition-transform"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      viewBox="0 0 24 24"
                    >
                      <path d="M9 5l7 7-7 7" />
                    </svg>
                  </button>
                  @if (openSection() === item.label) {
                    <div class="ml-4 space-y-1">
                      @for (child of item.children; track child.label) {
                        <a
                          [routerLink]="child.route"
                          class="block text-sm px-2 py-1 hover:underline text-gray-700"
                        >
                          {{ child.label }}
                        </a>
                      }
                    </div>
                  }
                </div>
              }
            }
          </div>
        }
      </nav>
    </div>
  </aside>

  <!-- Mobile Sidebar -->
  @if (showMobileSidebar()) {
    <div class="fixed inset-0 z-40 bg-black/30" (click)="toggleMobileSidebar()"></div>
    <div
      [class]="animateSidebar() ? 'animate-slide-in' : 'animate-slide-out'"
      class="fixed z-50 top-0 left-0 h-full w-64 bg-white shadow-xl flex flex-col"
      (click)="$event.stopPropagation()"
    >
      <!-- Close Button -->
      <div class="flex justify-end px-4 py-3">
        <button (click)="toggleMobileSidebar()" class="">âœ•</button>
      </div>

      <!-- Scrollable Nav Section -->
      <div
        class="flex-1 overflow-y-auto px-4 py-2 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100"
      >
        <nav class="space-y-6">
          @for (section of sidebar; track section.title) {
            <div>
              <p class="text-xs font-semibold text-gray-500 uppercase mb-2">
                {{ section.title }}
              </p>
              @for (item of section.items; track item.label) {
                @if (!item.children) {
                  <a
                    [routerLink]="item.route"
                    (click)="toggleMobileSidebar()"
                    class="block px-2 py-1.5 rounded hover:bg-gray-200 text-sm text-blue-700"
                  >
                    {{ item.label }}
                  </a>
                } @else {
                  <div>
                    <button
                      (click)="toggleSection(item.label)"
                      class="w-full flex justify-between items-center px-2 py-1.5 rounded hover:bg-gray-200 text-sm text-blue-700"
                    >
                      {{ item.label }}
                      <svg
                        [class]="{ 'rotate-90': openSection() === item.label }"
                        class="w-4 h-4 transition-transform"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        viewBox="0 0 24 24"
                      >
                        <path d="M9 5l7 7-7 7" />
                      </svg>
                    </button>
                    @if (openSection() === item.label) {
                      <div class="ml-4 space-y-1">
                        @for (child of item.children; track child.label) {
                          <a
                            [routerLink]="child.route"
                            (click)="toggleMobileSidebar()"
                            class="block text-sm px-2 py-1 hover:underline text-gray-700"
                          >
                            {{ child.label }}
                          </a>
                        }
                      </div>
                    }
                  </div>
                }
              }
            </div>
          }
        </nav>
      </div>
    </div>
  }

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto p-4">
    <router-outlet></router-outlet>
  </main>
</div>
