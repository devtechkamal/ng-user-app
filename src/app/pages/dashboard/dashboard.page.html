<app-container>
  <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="text-2xl font-semibold">Welcome back, {{ auth.fullName() }}</h1>
      <p class="text-sm text-muted-color">
        Role: {{ auth.role() }} · Last login: {{ auth.lastLoginAt() | date: 'medium' }}
      </p>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <p-card header="Total Users" class="shadow-sm rounded-2xl">
      <div class="text-3xl font-bold">{{ summary?.totalUsers ?? '—' }}</div>
      <div class="text-sm text-muted-color">All registered users</div>
    </p-card>

    <p-card header="Active Users" class="shadow-sm rounded-2xl">
      <div class="text-3xl font-bold">{{ summary?.activeUsers ?? '—' }}</div>
      <div class="text-sm text-muted-color">Logged in last 30 days</div>
    </p-card>

    <p-card header="New This Week" class="shadow-sm rounded-2xl">
      <div class="text-3xl font-bold">{{ summary?.newRegistrationsThisWeek ?? '—' }}</div>
      <div class="text-sm text-muted-color">Registrations in last 7 days</div>
    </p-card>

    <p-card header="Pending Approvals" class="shadow-sm rounded-2xl">
      <div class="text-3xl font-bold">{{ summary?.pendingApprovals ?? 0 }}</div>
      <div class="text-sm text-muted-color">Awaiting action</div>
    </p-card>
  </div>

  <!-- Charts Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <p-panel header="User Growth" class="rounded-2xl shadow-sm lg:col-span-2">
      <ng-template #content>
        <p-chart
          type="line"
          [data]="userGrowthData"
          [options]="lineOptions"
          style="min-height: 260px"
        ></p-chart
      ></ng-template>
    </p-panel>

    <p-panel header="Roles Distribution" class="rounded-2xl shadow-sm">
      <ng-template #content>
        <p-chart
          type="doughnut"
          [data]="roleDistributionData"
          [options]="doughnutOptions"
          style="min-height: 260px"
        ></p-chart>
      </ng-template>
    </p-panel>
  </div>

  <!-- Activity + Login Attempts -->
  <div class="grid">
    <p-panel header="Login Activity (7 days)" class="rounded-2xl shadow-sm">
      <ng-template #content>
        <p-chart
          type="bar"
          [data]="loginActivityData"
          [options]="barOptions"
          class="mt-8"
          style="min-height: 360px"
        ></p-chart>
      </ng-template>
    </p-panel>
  </div>

  <!-- Admin only: System status -->
  @if (auth.role() === 'Admin') {
    <p-panel header="System Status" class="rounded-2xl shadow-sm">
      <ng-template #content>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 rounded-xl border border-surface-200">
            <div class="text-sm text-muted-color">API Health</div>
            <div class="mt-1 font-semibold">OK</div>
            <div class="text-xs text-muted-color mt-1">/api/health</div>
          </div>
          <div class="p-4 rounded-xl border border-surface-200">
            <div class="text-sm text-muted-color">Database</div>
            <div class="mt-1 font-semibold">Connected</div>
            <div class="text-xs text-muted-color mt-1">MySQL (Prisma)</div>
          </div>
          <div class="p-4 rounded-xl border border-surface-200">
            <div class="text-sm text-muted-color">Active Sessions</div>
            <div class="mt-1 font-semibold">68</div>
            <div class="text-xs text-muted-color mt-1">JWT based</div>
          </div>
        </div>
      </ng-template>
    </p-panel>
  }
</app-container>
